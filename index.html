<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B·∫£n tin n√¥ng v·ª•</title>
  <style>
    body { margin:0; font-family: system-ui, Arial; background:#f6f7ff; }
    .wrap { max-width:1200px; margin:0 auto; padding:10px; }
    h2 { margin:10px 0; }
    .split { display:grid; grid-template-columns: 360px 1fr; height: calc(100vh - 80px); gap:10px; }
    .pane { background:#fff; border:2px solid #22c55e; overflow:auto; border-radius:10px; }
    .left { padding:10px; }
    .item { border:1px solid #e2e8f0; border-radius:10px; padding:12px; margin-bottom:10px; cursor:pointer; }
    .item:hover { background:#f1f5f9; }
    .item.selected { outline:3px solid #22c55e; }
    .title { font-weight:700; margin:6px 0; }
    .muted { color:#64748b; font-size:12px; }

    .viewer-toolbar { padding:8px; border-bottom:1px solid #e2e8f0; background:#fafafa; display:flex; gap:10px; align-items:center; }
    .docframe { width:100%; height:100%; border:0; }
    .viewer-area { height: calc(100% - 46px); }

    button { padding:6px 12px; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; }
    button:hover { background:#f1f5f9; }

    /* Popup ch·ªçn ƒë·ªãnh d·∫°ng */
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.4);
      display:none; align-items:center; justify-content:center;
      z-index: 999;
    }
    .modal-box {
      background:#fff; padding:20px; border-radius:12px;
      max-width:300px; width:90%;
      text-align:center;
    }
    .modal-box h3 { margin-top:0; }
    .modal-box button { width:100%; margin-top:10px; }

    @media (max-width: 900px){
      .split { grid-template-columns:1fr; height:auto; }
      .pane { min-height:300px; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <h2>üìÑ B·∫¢N TIN N√îNG V·ª§</h2>
  <div class="split">
    <aside class="pane left" id="list"></aside>
    <section class="pane right">
      <div class="viewer-toolbar">
        <button id="openNew">‚Üó M·ªü tab m·ªõi</button>
        <span id="fileName" class="muted"></span>
      </div>
      <div class="viewer-area" id="viewer">
        <div class="muted" style="padding:20px">Ch·ªçn 1 b·∫£n tin b√™n tr√°i ƒë·ªÉ xem</div>
      </div>
    </section>
  </div>
</div>

<!-- Modal ch·ªçn PDF / DOCX -->
<div class="modal" id="formatModal">
  <div class="modal-box">
    <h3>Ch·ªçn ƒë·ªãnh d·∫°ng</h3>
    <button id="btnPdf">üìÑ Xem PDF</button>
    <button id="btnDocx">üìù Xem DOCX</button>
    <button onclick="closeModal()">Hu·ª∑</button>
  </div>
</div>

<script>
const listEl = document.getElementById("list");
const viewer = document.getElementById("viewer");
const fileNameEl = document.getElementById("fileName");
const openNewBtn = document.getElementById("openNew");

const modal = document.getElementById("formatModal");
const btnPdf = document.getElementById("btnPdf");
const btnDocx = document.getElementById("btnDocx");

let currentUrl = null;
let currentItem = null;

function baseName(url){
  try { return decodeURIComponent(url.split('/').pop()); }
  catch { return url; }
}

function absoluteUrl(rel){
  return new URL(rel, window.location.href).href;
}

function showPdf(url){
  const abs = absoluteUrl(url);
  currentUrl = abs;
  fileNameEl.textContent = baseName(url);
  viewer.innerHTML = `<iframe class="docframe" src="${abs}"></iframe>`;
}

function showDocx(url){
  const abs = absoluteUrl(url);
  currentUrl = abs;
  fileNameEl.textContent = baseName(url);
  const officeUrl = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(abs)}`;
  viewer.innerHTML = `<iframe class="docframe" src="${officeUrl}"></iframe>`;
}

openNewBtn.onclick = () => {
  if(currentUrl) window.open(currentUrl, "_blank");
};

function openModal(item){
  currentItem = item;
  modal.style.display = "flex";
}

function closeModal(){
  modal.style.display = "none";
}

btnPdf.onclick = () => {
  closeModal();
  showPdf(currentItem.pdf_url);
};

btnDocx.onclick = () => {
  closeModal();
  showDocx(currentItem.docx_url);
};

async function loadData(){
  const res = await fetch("data/bulletins.json");
  const data = await res.json();

  // L·ªçc active + s·∫Øp x·∫øp m·ªõi nh·∫•t l√™n tr√™n
  const items = data
    .filter(x => x.is_active)
    .sort((a,b) => (b.year*100 + b.month) - (a.year*100 + a.month));

  listEl.innerHTML = "";

  if(items.length === 0){
    listEl.innerHTML = "<div class='muted'>Ch∆∞a c√≥ b·∫£n tin</div>";
    return;
  }

  items.forEach((it, idx) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="title">${it.title}</div>
      <div class="muted">Th√°ng ${it.month}/${it.year}</div>
    `;
    div.onclick = () => {
      document.querySelectorAll(".item").forEach(e => e.classList.remove("selected"));
      div.classList.add("selected");
      openModal(it);
    };
    listEl.appendChild(div);
  });
}

loadData();
</script>
</body>
</html>
