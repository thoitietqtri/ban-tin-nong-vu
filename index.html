<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B·∫¢N TIN N√îNG V·ª§</title>
  <style>
    body { margin:0; font-family: system-ui, Arial; background:#f6f7ff; }
    .wrap { max-width:1200px; margin:0 auto; padding:10px; }
    h2 { margin:10px 0; }
    .split { display:grid; grid-template-columns: 360px 1fr; height: calc(100vh - 80px); gap:10px; }
    .pane { background:#fff; border:2px solid #22c55e; overflow:auto; border-radius:10px; }
    .left { padding:10px; }
    .item { border:1px solid #e2e8f0; border-radius:10px; padding:12px; margin-bottom:10px; cursor:pointer; }
    .item:hover { background:#f1f5f9; }
    .item.selected { outline:3px solid #22c55e; }
    .title { font-weight:700; margin:6px 0; }
    .muted { color:#64748b; font-size:12px; }
    .viewer-toolbar { padding:8px; border-bottom:1px solid #e2e8f0; background:#fafafa; display:flex; gap:10px; align-items:center; }
    .docframe { width:100%; height:100%; border:0; }
    .viewer-area { height: calc(100% - 46px); }
    button { padding:6px 12px; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; }
    button:hover { background:#f1f5f9; }
    img { max-width:100%; }
    @media (max-width: 900px){
      .split { grid-template-columns:1fr; height:auto; }
      .pane { min-height:300px; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <h2>üìÑ B·∫£n tin n√¥ng v·ª•</h2>
  <div class="split">
    <aside class="pane left" id="list"></aside>
    <section class="pane right">
      <div class="viewer-toolbar">
        <button id="openNew">‚Üó M·ªü tab m·ªõi</button>
        <span id="fileName" class="muted"></span>
      </div>
      <div class="viewer-area" id="viewer">
        <div class="muted" style="padding:20px">Ch·ªçn 1 b·∫£n tin b√™n tr√°i ƒë·ªÉ xem</div>
      </div>
    </section>
  </div>
</div>

<script>
const listEl = document.getElementById("list");
const viewer = document.getElementById("viewer");
const fileNameEl = document.getElementById("fileName");
const openNewBtn = document.getElementById("openNew");

let currentUrl = null;

function baseName(url){
  try {
    return decodeURIComponent(url.split('/').pop());
  } catch { return url; }
}

function getExt(url){
  return url.split('.').pop().toLowerCase().split('?')[0];
}

function absoluteUrl(rel){
  return new URL(rel, window.location.href).href;
}

function showInViewer(url){
  currentUrl = url;
  fileNameEl.textContent = baseName(url);

  const ext = getExt(url);
  const abs = absoluteUrl(url);

  // PDF
  if(ext === "pdf"){
    viewer.innerHTML = `<iframe class="docframe" src="${abs}"></iframe>`;
    return;
  }

  // Office formats
  if(["doc","docx","xls","xlsx","ppt","pptx"].includes(ext)){
    const officeUrl = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(abs)}`;
    viewer.innerHTML = `<iframe class="docframe" src="${officeUrl}"></iframe>`;
    return;
  }

  // Images
  if(["png","jpg","jpeg","gif","webp"].includes(ext)){
    viewer.innerHTML = `<div style="padding:10px;text-align:center"><img src="${abs}"></div>`;
    return;
  }

  // Google fallback
  const googleUrl = `https://docs.google.com/gview?embedded=1&url=${encodeURIComponent(abs)}`;
  viewer.innerHTML = `<iframe class="docframe" src="${googleUrl}"></iframe>`;
}

openNewBtn.onclick = () => {
  if(currentUrl) window.open(currentUrl, "_blank");
};

async function loadData(){
  const res = await fetch("data/bulletins.json");
  const data = await res.json();

  const items = data.filter(x => x.is_active && x.doc_url);

  listEl.innerHTML = "";

  if(items.length === 0){
    listEl.innerHTML = "<div class='muted'>Ch∆∞a c√≥ b·∫£n tin</div>";
    return;
  }

  items.forEach((it, idx) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="muted">${it.published_on || ""}</div>
      <div class="title">${it.title || "B·∫£n tin"}</div>
      <div class="muted">${it.summary || ""}</div>
    `;
    div.onclick = () => {
      document.querySelectorAll(".item").forEach(e => e.classList.remove("selected"));
      div.classList.add("selected");
      showInViewer(it.doc_url);
    };
    listEl.appendChild(div);

    if(idx === 0){
      div.classList.add("selected");
      showInViewer(it.doc_url);
    }
  });
}

loadData();
</script>
</body>
</html>
