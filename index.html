<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>B·∫£n tin n√¥ng v·ª•</title>
  <style>
    body { margin:0; font-family: system-ui, Arial; background:#f6f7ff; }
    .wrap { max-width:1200px; margin:0 auto; padding:10px; }
    h2 { margin:10px 0; }
    .split { display:grid; grid-template-columns: 360px 1fr; height: calc(100vh - 80px); gap:10px; }
    .pane { background:#fff; border:2px solid #22c55e; overflow:auto; border-radius:10px; }
    .left { padding:10px; }
    .item { border:1px solid #e2e8f0; border-radius:10px; padding:12px; margin-bottom:10px; cursor:pointer; }
    .item:hover { background:#f1f5f9; }
    .item.selected { outline:3px solid #22c55e; }
    .title { font-weight:700; margin:6px 0; }
    .muted { color:#64748b; font-size:12px; }

    .viewer-toolbar { padding:8px; border-bottom:1px solid #e2e8f0; background:#fafafa; display:flex; gap:10px; align-items:center; }
    .docframe { width:100%; height:100%; border:0; }
    .viewer-area { height: calc(100% - 46px); }

    button { padding:6px 12px; border-radius:8px; border:1px solid #ccc; background:#fff; cursor:pointer; }
    button:hover { background:#f1f5f9; }

    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.4);
      display:none; align-items:center; justify-content:center;
      z-index: 999;
    }
    .modal-box {
      background:#fff; padding:20px; border-radius:12px;
      max-width:300px; width:90%;
      text-align:center;
    }
    .modal-box h3 { margin-top:0; }
    .modal-box button { width:100%; margin-top:10px; }

    @media (max-width: 900px){
      .split { grid-template-columns:1fr; height:auto; }
      .pane { min-height:300px; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <h2>üìÑ B·∫¢N TIN N√îNG V·ª§</h2>
  <div class="split">
    <aside class="pane left" id="list"></aside>
    <section class="pane right">
      <div class="viewer-toolbar">
        <button id="openNew">‚Üó T·∫£i file </button>
        <span id="fileName" class="muted"></span>
      </div>
      <div class="viewer-area" id="viewer">
        <div class="muted" style="padding:20px">Ch·ªçn 1 b·∫£n tin b√™n tr√°i ƒë·ªÉ xem</div>
      </div>
    </section>
  </div>
</div>

<div class="modal" id="formatModal">
  <div class="modal-box">
    <h3>Ch·ªçn ƒë·ªãnh d·∫°ng</h3>
    <button id="btnPdf">üìÑ Xem PDF</button>
    <button id="btnDocx">üìù Xem DOCX</button>
    <button onclick="closeModal()">Hu·ª∑</button>
  </div>
</div>

<script>
const OWNER = "thoitietqtri";
const REPO  = "ban-tin-nong-vu";
const FOLDER_PATH = "files/BAN-TIN-NONG-VU";

const listEl = document.getElementById("list");
const viewer = document.getElementById("viewer");
const fileNameEl = document.getElementById("fileName");
const openNewBtn = document.getElementById("openNew");

const modal = document.getElementById("formatModal");
const btnPdf = document.getElementById("btnPdf");
const btnDocx = document.getElementById("btnDocx");

let currentUrl = null;
let currentItem = null;

function baseName(url){
  try { return decodeURIComponent(url.split('/').pop()); }
  catch { return url; }
}

function showPdf(url){
  currentUrl = url;
  fileNameEl.textContent = baseName(url);
  const pdfjs = `https://mozilla.github.io/pdf.js/web/viewer.html?file=${encodeURIComponent(url)}`;
  viewer.innerHTML = `<iframe class="docframe" src="${pdfjs}"></iframe>`;
}

function showDocx(url){
  currentUrl = url;
  fileNameEl.textContent = baseName(url);
  const officeUrl = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(url)}`;
  viewer.innerHTML = `<iframe class="docframe" src="${officeUrl}"></iframe>`;
}

openNewBtn.onclick = () => {
  if(currentUrl) window.open(currentUrl, "_blank");
};

function openModal(item){
  currentItem = item;
  modal.style.display = "flex";
}

function closeModal(){
  modal.style.display = "none";
}

btnPdf.onclick = () => {
  closeModal();
  showPdf(currentItem.pdf_url);
};

btnDocx.onclick = () => {
  closeModal();
  showDocx(currentItem.docx_url);
};

function parseFile(name){
  const m = name.match(/ban-tin-nong-vu-thang-(\d{2})-(\d{4})\.(pdf|docx)$/i);
  if(!m) return null;
  return { month: parseInt(m[1],10), year: parseInt(m[2],10), ext: m[3].toLowerCase() };
}

async function loadFromGitHub(){
  const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FOLDER_PATH}`;
  const res = await fetch(api);
  if(!res.ok){
    listEl.innerHTML = `<div class="muted">Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c th∆∞ m·ª•c GitHub.</div>`;
    return;
  }
  const files = await res.json();

  const map = {};
  files.forEach(f => {
    if(f.type !== "file") return;
    const p = parseFile(f.name);
    if(!p) return;
    const key = `${p.year}-${String(p.month).padStart(2,"0")}`;
    if(!map[key]) map[key] = { year: p.year, month: p.month, pdf_url:null, docx_url:null };
    if(p.ext === "pdf")  map[key].pdf_url  = f.download_url;
    if(p.ext === "docx") map[key].docx_url = f.download_url;
  });

  let items = Object.values(map).filter(x => x.pdf_url && x.docx_url);
  items.sort((a,b) => (b.year*100 + b.month) - (a.year*100 + a.month));

  listEl.innerHTML = "";
  if(items.length === 0){
    listEl.innerHTML = "<div class='muted'>Ch∆∞a c√≥ b·∫£n tin h·ª£p l·ªá.</div>";
    return;
  }

  items.forEach(it => {
    const div = document.createElement("div");
    div.className = "item";
    const title = `B·∫£n tin n√¥ng v·ª• th√°ng ${it.month}/${it.year}`;
    div.innerHTML = `
      <div class="title">${title}</div>
      <div class="muted">C√≥ PDF & DOCX</div>
    `;
    div.onclick = () => {
      document.querySelectorAll(".item").forEach(e => e.classList.remove("selected"));
      div.classList.add("selected");
      openModal(it);
    };
    listEl.appendChild(div);
  });
}

loadFromGitHub();
</script>
</body>
</html>

